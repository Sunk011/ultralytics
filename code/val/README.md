# YOLOç›®æ ‡æ£€æµ‹è¯„ä»·å·¥å…·

## åŠŸèƒ½è¯´æ˜
æœ¬å·¥å…·ç”¨äºè¯„ä»·YOLOæ¨¡å‹çš„æ¨ç†ç»“æœï¼Œé€šè¿‡å¯¹æ¯”é¢„æµ‹æ¡†ä¸çœŸå®æ ‡æ³¨æ¡†æ¥è®¡ç®—mAPç­‰æ€§èƒ½æŒ‡æ ‡ã€‚

## æ”¯æŒçš„æŒ‡æ ‡
- **mAP (mean Average Precision)**: å¹³å‡ç²¾åº¦å‡å€¼
- **Precision**: ç²¾ç¡®ç‡
- **Recall**: å¬å›ç‡ 
- **F1-Score**: F1åˆ†æ•°
- **AP (Average Precision)**: å„ç±»åˆ«çš„å¹³å‡ç²¾åº¦

## æ–°å¢åŠŸèƒ½ âœ¨
- **ä¸­æ–‡å¯è§†åŒ–æ”¯æŒ**: å›¾è¡¨æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ä¾‹å®Œå…¨æ”¯æŒä¸­æ–‡æ˜¾ç¤º
- **å¤šç§å›¾è¡¨ç±»å‹**: APæŸ±çŠ¶å›¾ã€PRå…³ç³»å›¾ã€é›·è¾¾å›¾ã€ç±»åˆ«å¯¹æ¯”å›¾
- **HTMLæŠ¥å‘Š**: ç”Ÿæˆç¾è§‚çš„ä¸­æ–‡HTMLè¯„ä»·æŠ¥å‘Š
- **è‡ªå®šä¹‰ç±»åˆ«åç§°**: æ”¯æŒåŠ è½½ä¸­æ–‡ç±»åˆ«åç§°æ–‡ä»¶

## è¾“å…¥æ ¼å¼

### é¢„æµ‹ç»“æœæ ¼å¼ (YOLOæ ¼å¼)
æ¯ä¸ªtxtæ–‡ä»¶å¯¹åº”ä¸€å¼ å›¾åƒï¼Œæ ¼å¼ä¸ºï¼š
```
class_id x_center y_center width height confidence
```

### çœŸå®æ ‡æ³¨æ ¼å¼ (YOLOæ ¼å¼)
æ¯ä¸ªtxtæ–‡ä»¶å¯¹åº”ä¸€å¼ å›¾åƒï¼Œæ ¼å¼ä¸ºï¼š
```
class_id x_center y_center width height
```

**æ³¨æ„**: åæ ‡ä¸ºç›¸å¯¹åæ ‡ (0-1ä¹‹é—´çš„æµ®ç‚¹æ•°)

## ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œä½¿ç”¨
```bash
# åŸºç¡€è¯„ä»·
python evaluate.py \
    --pred_dir /path/to/predictions \
    --gt_dir /path/to/ground_truths \
    --conf_threshold 0.25 \
    --iou_threshold 0.5 \
    --output results.txt

# ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
python evaluate.py \
    --pred_dir /path/to/predictions \
    --gt_dir /path/to/ground_truths \
    --visualize \
    --output_dir visualization_results

# ç”Ÿæˆä¸­æ–‡HTMLæŠ¥å‘Šï¼ˆæ¨èï¼‰
python evaluate.py \
    --pred_dir /path/to/predictions \
    --gt_dir /path/to/ground_truths \
    --html_report \
    --class_names class_names.txt \
    --output_dir evaluation_report
```

### 2. Pythonä»£ç ä½¿ç”¨
```python
from evaluate import DetectionEvaluator

# åˆ›å»ºè¯„ä»·å™¨
evaluator = DetectionEvaluator(
    pred_dir="/path/to/predictions",
    gt_dir="/path/to/ground_truths", 
    conf_threshold=0.25,
    iou_threshold=0.5
)

# è¿è¡Œè¯„ä»·
metrics = evaluator.run_evaluation()

# ä¿å­˜ç»“æœ
evaluator.save_results("evaluation_results.txt")

# ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
class_names = {0: "äººå‘˜", 1: "è½¦è¾†", 2: "åŠ¨ç‰©"}
evaluator.save_visualization_charts("charts", class_names)

# ç”ŸæˆHTMLæŠ¥å‘Š
evaluator.generate_detailed_report("report", class_names)
```

### 3. ç±»åˆ«åç§°æ–‡ä»¶æ ¼å¼
åˆ›å»º `class_names.txt` æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªç±»åˆ«åç§°ï¼š
```
äººå‘˜
è½¦è¾†
åŠ¨ç‰©
å»ºç­‘ç‰©
äº¤é€šæ ‡å¿—
```

## å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| pred_dir | é¢„æµ‹ç»“æœç›®å½•è·¯å¾„ | å¿…å¡« |
| gt_dir | çœŸå®æ ‡æ³¨ç›®å½•è·¯å¾„ | å¿…å¡« |
| conf_threshold | ç½®ä¿¡åº¦é˜ˆå€¼ | 0.25 |
| iou_threshold | IoUé˜ˆå€¼ | 0.5 |
| output | ç»“æœä¿å­˜è·¯å¾„ | evaluation_results.txt |
| visualize | ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ | False |
| output_dir | è¾“å‡ºç›®å½•ï¼ˆåŒ…å«å›¾è¡¨ï¼‰ | evaluation_output |
| html_report | ç”ŸæˆHTMLæ ¼å¼æŠ¥å‘Š | False |
| class_names | ç±»åˆ«åç§°æ–‡ä»¶è·¯å¾„ | None |

## è¾“å‡ºç»“æœ

### æ§åˆ¶å°è¾“å‡º
```
================================================================================
YOLOç›®æ ‡æ£€æµ‹æ€§èƒ½è¯„ä»·ç»“æœ
================================================================================
IoUé˜ˆå€¼: 0.5
ç½®ä¿¡åº¦é˜ˆå€¼: 0.25
æ€»ç±»åˆ«æ•°: 3
mAP@0.5: 0.7543

å„ç±»åˆ«è¯¦ç»†æŒ‡æ ‡:
--------------------------------------------------------------------------------
ç±»åˆ«ID   Precision    Recall       F1-Score     AP          
--------------------------------------------------------------------------------
0        0.8234       0.7891       0.8059       0.7823      
1        0.7453       0.6982       0.7211       0.6834      
2        0.8901       0.8234       0.8553       0.7972      
--------------------------------------------------------------------------------
å¹³å‡     0.8196       0.7702       0.7941       0.7543      
================================================================================

å„ç±»åˆ«APæ’å:
----------------------------------------
 1. ç±»åˆ«2: AP=0.7972
 2. ç±»åˆ«0: AP=0.7823
 3. ç±»åˆ«1: AP=0.6834
----------------------------------------
```

### å¯è§†åŒ–å›¾è¡¨
ä½¿ç”¨ `--visualize` å‚æ•°å¯ç”Ÿæˆä»¥ä¸‹å›¾è¡¨ï¼š
- **APæŸ±çŠ¶å›¾**: å„ç±»åˆ«APå¯¹æ¯”
- **PRå…³ç³»å›¾**: ç²¾ç¡®ç‡-å¬å›ç‡å…³ç³»
- **é›·è¾¾å›¾**: æ•´ä½“æ€§èƒ½æŒ‡æ ‡
- **ç±»åˆ«å¯¹æ¯”å›¾**: å„ç±»åˆ«å¤šæŒ‡æ ‡å¯¹æ¯”

### HTMLæŠ¥å‘Š
ä½¿ç”¨ `--html_report` å‚æ•°å¯ç”ŸæˆåŒ…å«ä»¥ä¸‹å†…å®¹çš„HTMLæŠ¥å‘Šï¼š
- ğŸ“Š äº¤äº’å¼æ•°æ®è¡¨æ ¼
- ğŸ“ˆ é«˜è´¨é‡å¯è§†åŒ–å›¾è¡¨
- ğŸ“‹ è¯¦ç»†çš„æŒ‡æ ‡è¯´æ˜
- ğŸ¨ ç¾è§‚çš„ä¸­æ–‡ç•Œé¢

## æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶å¯¹åº”**: é¢„æµ‹ç»“æœæ–‡ä»¶åå¿…é¡»ä¸çœŸå®æ ‡æ³¨æ–‡ä»¶åä¸€è‡´
2. **åæ ‡æ ¼å¼**: é»˜è®¤å‡è®¾è¾“å…¥ä¸ºç›¸å¯¹åæ ‡ï¼Œå†…éƒ¨ä¼šè½¬æ¢ä¸ºç»å¯¹åæ ‡
3. **å›¾åƒå°ºå¯¸**: å½“å‰é»˜è®¤ä½¿ç”¨640x640ï¼Œå®é™…ä½¿ç”¨æ—¶å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´
4. **ç½®ä¿¡åº¦è¿‡æ»¤**: åªæœ‰ç½®ä¿¡åº¦å¤§äºç­‰äºé˜ˆå€¼çš„é¢„æµ‹æ¡†æ‰ä¼šå‚ä¸è¯„ä»·

## æ‰©å±•åŠŸèƒ½

### æ‰¹é‡è¯„ä»·ä¸åŒIoUé˜ˆå€¼
```python
iou_thresholds = [0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]
for iou_thresh in iou_thresholds:
    evaluator = DetectionEvaluator(pred_dir, gt_dir, iou_threshold=iou_thresh)
    metrics = evaluator.run_evaluation()
    print(f"mAP@{iou_thresh}: {metrics['mAP']:.4f}")
```

### è‡ªå®šä¹‰å¯è§†åŒ–
```python
# ä½¿ç”¨è‡ªå®šä¹‰ç±»åˆ«åç§°
class_names = {
    0: "äººå‘˜",
    1: "è½¦è¾†", 
    2: "åŠ¨ç‰©",
    3: "å»ºç­‘ç‰©"
}

# ç”Ÿæˆå•ä¸ªå›¾è¡¨
evaluator.plot_class_ap_chart("ap_chart.png", class_names)
evaluator.plot_precision_recall_chart("pr_chart.png", class_names)
evaluator.plot_metrics_radar_chart("radar_chart.png")

# ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
evaluator.generate_detailed_report("my_report", class_names)
```

### å¿«é€Ÿæ¼”ç¤º
```bash
# è¿è¡Œä¸­æ–‡å¯è§†åŒ–æ¼”ç¤º
python demo_chinese.py
```

## å¸¸è§é—®é¢˜

1. **Q**: å¦‚ä½•å¤„ç†ä¸åŒå›¾åƒå°ºå¯¸ï¼Ÿ
   **A**: éœ€è¦ä¿®æ”¹ä»£ç ä¸­çš„å›¾åƒå°ºå¯¸è®¾ç½®ï¼Œæˆ–è€…ä¼ å…¥å›¾åƒå°ºå¯¸ä¿¡æ¯

2. **Q**: æ”¯æŒCOCOæ ¼å¼çš„æ ‡æ³¨å—ï¼Ÿ
   **A**: å½“å‰åªæ”¯æŒYOLOæ ¼å¼ï¼Œå¦‚éœ€æ”¯æŒå…¶ä»–æ ¼å¼éœ€è¦æ·»åŠ è½¬æ¢å‡½æ•°

3. **Q**: å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰ç±»åˆ«åç§°ï¼Ÿ
   **A**: åˆ›å»ºç±»åˆ«åç§°æ–‡ä»¶æˆ–åœ¨ä»£ç ä¸­ä½¿ç”¨class_nameså­—å…¸

4. **Q**: ä¸­æ–‡å­—ç¬¦æ— æ³•æ˜¾ç¤ºæ€ä¹ˆåŠï¼Ÿ
   **A**: ç¡®ä¿ç³»ç»Ÿå®‰è£…äº†ä¸­æ–‡å­—ä½“ï¼Œå·¥å…·ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨å¯ç”¨çš„ä¸­æ–‡å­—ä½“

5. **Q**: å¦‚ä½•å®‰è£…ä¾èµ–ï¼Ÿ
   **A**: è¿è¡Œ `pip install numpy matplotlib pillow` å®‰è£…å¿…è¦ä¾èµ–

6. **Q**: HTMLæŠ¥å‘Šæ— æ³•æ‰“å¼€æ€ä¹ˆåŠï¼Ÿ
   **A**: ä½¿ç”¨ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeï¼‰æ‰“å¼€HTMLæ–‡ä»¶

## ä¾èµ–è¦æ±‚
```bash
pip install numpy matplotlib pillow
```

## å­—ä½“æ”¯æŒ
å·¥å…·æ”¯æŒä»¥ä¸‹ä¸­æ–‡å­—ä½“ï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼‰ï¼š
- SimHei (é»‘ä½“)
- Microsoft YaHei (å¾®è½¯é›…é»‘)
- PingFang SC (è‹¹æ–¹)
- WenQuanYi Micro Hei (æ–‡æ³‰é©¿å¾®ç±³é»‘)
- Noto Sans CJK SC (æ€æºé»‘ä½“)
